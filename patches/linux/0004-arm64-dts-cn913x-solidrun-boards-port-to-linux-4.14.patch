From 651daceb131047a23fa5b73765de4b4792573abb Mon Sep 17 00:00:00 2001
From: Josua Mayer <josua@solid-run.com>
Date: Thu, 9 May 2024 14:43:58 +0200
Subject: [PATCH 04/45] arm64: dts: cn913x solidrun boards: port to linux 4.14

Signed-off-by: Josua Mayer <josua@solid-run.com>
---
 .../arm64/boot/dts/marvell/cn9130-cf-base.dts |  46 +-----
 arch/arm64/boot/dts/marvell/cn9130-cf-pro.dts | 132 +-----------------
 arch/arm64/boot/dts/marvell/cn9130-cf.dtsi    |  13 +-
 .../arm64/boot/dts/marvell/cn9130-sr-som.dtsi |   5 -
 .../boot/dts/marvell/cn9131-cf-solidwan.dts   | 125 ++++-------------
 5 files changed, 40 insertions(+), 281 deletions(-)

diff --git a/arch/arm64/boot/dts/marvell/cn9130-cf-base.dts b/arch/arm64/boot/dts/marvell/cn9130-cf-base.dts
index 788a5c302b17..d79481a12dca 100644
--- a/arch/arm64/boot/dts/marvell/cn9130-cf-base.dts
+++ b/arch/arm64/boot/dts/marvell/cn9130-cf-base.dts
@@ -68,25 +68,6 @@
 	 * - LED[2]: high impedance (floating)
 	 */
 	marvell,reg-init = <3 16 0xf000 0x0a61>;
-
-	leds {
-		#address-cells = <1>;
-		#size-cells = <0>;
-
-		led@0 {
-			reg = <0>;
-			color = <LED_COLOR_ID_GREEN>;
-			function = LED_FUNCTION_WAN;
-			default-state = "keep";
-		};
-
-		led@1 {
-			reg = <1>;
-			color = <LED_COLOR_ID_YELLOW>;
-			function = LED_FUNCTION_WAN;
-			default-state = "keep";
-		};
-	};
 };
 
 &cp0_gpio1 {
@@ -113,25 +94,6 @@
 		 */
 		marvell,reg-init = <3 16 0xf000 0x0a61>,
 				   <3 17 0x003f 0x000a>;
-
-		leds {
-			#address-cells = <1>;
-			#size-cells = <0>;
-
-			led@0 {
-				reg = <0>;
-				color = <LED_COLOR_ID_GREEN>;
-				function = LED_FUNCTION_LAN;
-				default-state = "keep";
-			};
-
-			led@1 {
-				reg = <1>;
-				color = <LED_COLOR_ID_YELLOW>;
-				function = LED_FUNCTION_LAN;
-				default-state = "keep";
-			};
-		};
 	};
 };
 
@@ -155,12 +117,16 @@
  * USB-2.0 Host on Type-A connector
  */
 &cp0_usb3_1 {
-	phys = <&cp0_comphy4 1>, <&cp0_utmi1>;
-	phy-names = "comphy", "utmi";
+	phys = <&cp0_utmi1>, <&cp0_comphy4 1>;
+	phy-names = "usb", "usb3";
 	dr_mode = "host";
 	status = "okay";
 };
 
+&cp0_utmi1 {
+	status = "okay";
+};
+
 &expander0 {
 	m2-full-card-power-off-hog {
 		gpio-hog;
diff --git a/arch/arm64/boot/dts/marvell/cn9130-cf-pro.dts b/arch/arm64/boot/dts/marvell/cn9130-cf-pro.dts
index a27fe0042867..06a0943cc9a8 100644
--- a/arch/arm64/boot/dts/marvell/cn9130-cf-pro.dts
+++ b/arch/arm64/boot/dts/marvell/cn9130-cf-pro.dts
@@ -61,27 +61,6 @@
 	 * Identical configuration is impossible with hardware offload.
 	 */
 	marvell,reg-init = <3 16 0xf000 0x0a61>;
-
-	leds {
-		#address-cells = <1>;
-		#size-cells = <0>;
-
-		led@0 {
-			reg = <0>;
-			color = <LED_COLOR_ID_GREEN>;
-			function = LED_FUNCTION_WAN;
-			label = "LED2";
-			default-state = "keep";
-		};
-
-		led@1 {
-			reg = <1>;
-			color = <LED_COLOR_ID_RED>;
-			function = LED_FUNCTION_WAN;
-			label = "LED1";
-			default-state = "keep";
-		};
-	};
 };
 
 &cp0_mdio {
@@ -102,135 +81,30 @@
 				reg = <0>;
 				label = "lan5";
 				phy = <&switch0phy0>;
-
-				leds {
-					#address-cells = <1>;
-					#size-cells = <0>;
-
-					led@0 {
-						reg = <0>;
-						color = <LED_COLOR_ID_GREEN>;
-						function = LED_FUNCTION_LAN;
-						label = "LED12";
-						default-state = "keep";
-					};
-
-					led@1 {
-						reg = <1>;
-						color = <LED_COLOR_ID_RED>;
-						function = LED_FUNCTION_LAN;
-						label = "LED11";
-						default-state = "keep";
-					};
-				};
 			};
 
 			ethernet-port@1 {
 				reg = <1>;
 				label = "lan4";
 				phy = <&switch0phy1>;
-
-				leds {
-					#address-cells = <1>;
-					#size-cells = <0>;
-
-					led@0 {
-						reg = <0>;
-						color = <LED_COLOR_ID_GREEN>;
-						function = LED_FUNCTION_LAN;
-						label = "LED10";
-						default-state = "keep";
-					};
-
-					led@1 {
-						reg = <1>;
-						color = <LED_COLOR_ID_RED>;
-						function = LED_FUNCTION_LAN;
-						label = "LED9";
-						default-state = "keep";
-					};
-				};
 			};
 
 			ethernet-port@2 {
 				reg = <2>;
 				label = "lan3";
 				phy = <&switch0phy2>;
-
-				leds {
-					#address-cells = <1>;
-					#size-cells = <0>;
-
-					led@0 {
-						reg = <0>;
-						color = <LED_COLOR_ID_GREEN>;
-						function = LED_FUNCTION_LAN;
-						label = "LED8";
-						default-state = "keep";
-					};
-
-					led@1 {
-						reg = <1>;
-						color = <LED_COLOR_ID_RED>;
-						function = LED_FUNCTION_LAN;
-						label = "LED7";
-						default-state = "keep";
-					};
-				};
 			};
 
 			ethernet-port@3 {
 				reg = <3>;
 				label = "lan2";
 				phy = <&switch0phy3>;
-
-				leds {
-					#address-cells = <1>;
-					#size-cells = <0>;
-
-					led@0 {
-						reg = <0>;
-						color = <LED_COLOR_ID_GREEN>;
-						function = LED_FUNCTION_LAN;
-						label = "LED6";
-						default-state = "keep";
-					};
-
-					led@1 {
-						reg = <1>;
-						color = <LED_COLOR_ID_RED>;
-						function = LED_FUNCTION_LAN;
-						label = "LED5";
-						default-state = "keep";
-					};
-				};
 			};
 
 			ethernet-port@4 {
 				reg = <4>;
 				label = "lan1";
 				phy = <&switch0phy4>;
-
-				leds {
-					#address-cells = <1>;
-					#size-cells = <0>;
-
-					led@0 {
-						reg = <0>;
-						color = <LED_COLOR_ID_GREEN>;
-						function = LED_FUNCTION_LAN;
-						label = "LED4";
-						default-state = "keep";
-					};
-
-					led@1 {
-						reg = <1>;
-						color = <LED_COLOR_ID_RED>;
-						function = LED_FUNCTION_LAN;
-						label = "LED3";
-						default-state = "keep";
-					};
-				};
 			};
 
 			ethernet-port@5 {
@@ -351,11 +225,15 @@
 /* USB-2.0 Host on Type-A connector */
 &cp0_usb3_1 {
 	phys = <&cp0_utmi1>;
-	phy-names = "utmi";
+	phy-names = "usb";
 	dr_mode = "host";
 	status = "okay";
 };
 
+&cp0_utmi1 {
+	status = "okay";
+};
+
 &expander0 {
 	/* CON2 */
 	pcie1-0-clkreq-hog {
diff --git a/arch/arm64/boot/dts/marvell/cn9130-cf.dtsi b/arch/arm64/boot/dts/marvell/cn9130-cf.dtsi
index ad0ab34b6602..80f9ae3613fd 100644
--- a/arch/arm64/boot/dts/marvell/cn9130-cf.dtsi
+++ b/arch/arm64/boot/dts/marvell/cn9130-cf.dtsi
@@ -39,7 +39,7 @@
 &cp0_eth0 {
 	managed = "in-band-status";
 	phys = <&cp0_comphy2 0>;
-	phy-mode = "10gbase-r";
+	phy-mode = "10gbase-kr";
 	sfp = <&sfp>;
 	status = "okay";
 };
@@ -123,11 +123,6 @@
 };
 
 &cp0_pinctrl {
-	cp0_i2c1_pins: cp0-i2c1-pins {
-		marvell,pins = "mpp35", "mpp36";
-		marvell,function = "i2c1";
-	};
-
 	cp0_mmc0_pins: cp0-mmc0-pins {
 		marvell,pins = "mpp43", "mpp56", "mpp57", "mpp58",
 			       "mpp59", "mpp60", "mpp61";
@@ -178,14 +173,14 @@
  * USB-2.0 Host on mPCI-e connector (CON3)
  */
 &cp0_usb3_0 {
-	phys = <&cp0_comphy1 0>, <&cp0_utmi0>;
-	phy-names = "comphy", "utmi";
+	phys = <&cp0_utmi0>, <&cp0_comphy1 0>;
+	phy-names = "usb", "usb3";
 	vbus-supply = <&reg_usb3_vbus0>;
 	dr_mode = "host";
 	status = "okay";
 };
 
-&cp0_utmi {
+&cp0_utmi0 {
 	status = "okay";
 };
 
diff --git a/arch/arm64/boot/dts/marvell/cn9130-sr-som.dtsi b/arch/arm64/boot/dts/marvell/cn9130-sr-som.dtsi
index 4676e3488f54..331893f3892d 100644
--- a/arch/arm64/boot/dts/marvell/cn9130-sr-som.dtsi
+++ b/arch/arm64/boot/dts/marvell/cn9130-sr-som.dtsi
@@ -130,11 +130,6 @@
 			marvell,function = "ge1";
 		};
 
-		cp0_i2c0_pins: cp0-i2c0-pins {
-			marvell,pins = "mpp37", "mpp38";
-			marvell,function = "i2c0";
-		};
-
 		cp0_mdio_pins: cp0-mdio-pins {
 			marvell,pins = "mpp40", "mpp41";
 			marvell,function = "ge";
diff --git a/arch/arm64/boot/dts/marvell/cn9131-cf-solidwan.dts b/arch/arm64/boot/dts/marvell/cn9131-cf-solidwan.dts
index f41e5dd22c7e..2f9c9524e380 100644
--- a/arch/arm64/boot/dts/marvell/cn9131-cf-solidwan.dts
+++ b/arch/arm64/boot/dts/marvell/cn9131-cf-solidwan.dts
@@ -18,23 +18,18 @@
  * Instantiate the external CP115
  */
 
-#define CP11X_NAME		cp1
-#define CP11X_BASE		f4000000
-#define CP11X_PCIEx_MEM_BASE(iface) (0xe2000000 + (iface * 0x1000000))
-#define CP11X_PCIEx_MEM_SIZE(iface) 0xf00000
-#define CP11X_PCIE0_BASE	f4600000
-#define CP11X_PCIE1_BASE	f4620000
-#define CP11X_PCIE2_BASE	f4640000
-
-#include "armada-cp115.dtsi"
-
-#undef CP11X_NAME
-#undef CP11X_BASE
-#undef CP11X_PCIEx_MEM_BASE
-#undef CP11X_PCIEx_MEM_SIZE
-#undef CP11X_PCIE0_BASE
-#undef CP11X_PCIE1_BASE
-#undef CP11X_PCIE2_BASE
+#undef CP110_NUM
+#undef CP110_PCIE_MEM_SIZE
+#undef CP110_PCIEx_CPU_MEM_BASE
+#undef CP110_PCIEx_BUS_MEM_BASE
+
+/* CP110-1 Settings */
+#define CP110_NUM			1
+#define CP110_PCIE_MEM_SIZE(iface)	(0xf00000)
+#define CP110_PCIEx_CPU_MEM_BASE(iface)	(0xe2000000 + (iface) * 0x1000000)
+#define CP110_PCIEx_BUS_MEM_BASE(iface)	(CP110_PCIEx_CPU_MEM_BASE(iface))
+
+#include "armada-cp110.dtsi"
 
 / {
 	model = "SolidRun CN9131 SolidWAN";
@@ -150,7 +145,7 @@
 /* SRDS #2 - SFP+ 10GE */
 &cp0_eth0 {
 	managed = "in-band-status";
-	phy-mode = "10gbase-r";
+	phy-mode = "10gbase-kr";
 	phys = <&cp0_comphy2 0>;
 	sfp = <&sfp0>;
 	status = "okay";
@@ -285,25 +280,6 @@
 		 * - LED[2]: high impedance (floating)
 		 */
 		marvell,reg-init = <3 16 0xf000 0x0a17>;
-
-		leds {
-			#address-cells = <1>;
-			#size-cells = <0>;
-
-			led@0 {
-				reg = <0>;
-				color = <LED_COLOR_ID_YELLOW>;
-				function = LED_FUNCTION_LAN;
-				default-state = "keep";
-			};
-
-			led@1 {
-				reg = <1>;
-				color = <LED_COLOR_ID_GREEN>;
-				function = LED_FUNCTION_LAN;
-				default-state = "keep";
-			};
-		};
 	};
 };
 
@@ -325,11 +301,6 @@
 	pinctrl-0 = <&cp0_m2_0_shutdown_pins &cp0_mpcie_rfkill_pins>;
 	pinctrl-names = "default";
 
-	cp0_i2c1_pins: cp0-i2c1-pins {
-		marvell,pins = "mpp35", "mpp36";
-		marvell,function = "i2c1";
-	};
-
 	cp0_led_pins: cp0-led-pins {
 		marvell,pins = "mpp4", "mpp7";
 		marvell,function = "gpio";
@@ -396,31 +367,19 @@
 /* USB-2.0 Host to USB-Hub */
 &cp0_usb3_0 {
 	phys = <&cp0_utmi0>;
-	phy-names = "utmi";
+	phy-names = "usb";
 	dr_mode = "host";
 	status = "okay";
 };
 
 /* SRDS #4 - USB-3.0 Host to USB-Hub */
 &cp0_usb3_1 {
-	phys = <&cp0_comphy4 1>, <&cp0_utmi1>;
-	phy-names = "comphy", "utmi";
+	phys = <&cp0_utmi1>, <&cp0_comphy4 1>;
+	phy-names = "usb", "usb3";
 	dr_mode = "host";
 	status = "okay";
 };
 
-&cp0_utmi {
-	status = "okay";
-};
-
-&cp0_utmi {
-	status = "okay";
-};
-
-&cp0_utmi1 {
-	status = "disabled";
-};
-
 &cp1_ethernet {
 	status = "okay";
 };
@@ -428,7 +387,7 @@
 /* SRDS #4 - SFP+ 10GE */
 &cp1_eth0 {
 	managed = "in-band-status";
-	phy-mode = "10gbase-r";
+	phy-mode = "10gbase-kr";
 	phys = <&cp1_comphy4 0>;
 	sfp = <&sfp1>;
 	status = "okay";
@@ -502,25 +461,6 @@
 		 * - LED[2]: high impedance (floating)
 		 */
 		marvell,reg-init = <3 16 0xf000 0x0a17>;
-
-		leds {
-			#address-cells = <1>;
-			#size-cells = <0>;
-
-			led@0 {
-				reg = <0>;
-				color = <LED_COLOR_ID_YELLOW>;
-				function = LED_FUNCTION_LAN;
-				default-state = "keep";
-			};
-
-			led@1 {
-				reg = <1>;
-				color = <LED_COLOR_ID_GREEN>;
-				function = LED_FUNCTION_LAN;
-				default-state = "keep";
-			};
-		};
 	};
 
 	cp1_phy1: ethernet-phy@1 {
@@ -532,25 +472,6 @@
 		 * - LED[2]: high impedance (floating)
 		 */
 		marvell,reg-init = <3 16 0xf000 0x0a17>;
-
-		leds {
-			#address-cells = <1>;
-			#size-cells = <0>;
-
-			led@0 {
-				reg = <0>;
-				color = <LED_COLOR_ID_YELLOW>;
-				function = LED_FUNCTION_LAN;
-				default-state = "keep";
-			};
-
-			led@1 {
-				reg = <1>;
-				color = <LED_COLOR_ID_GREEN>;
-				function = LED_FUNCTION_LAN;
-				default-state = "keep";
-			};
-		};
 	};
 };
 
@@ -622,20 +543,24 @@
  * USB-2.0 Host to M.2 (J30)
  */
 &cp1_usb3_0 {
-	phys = <&cp1_comphy2 0>, <&cp1_utmi0>;
-	phy-names = "comphy", "utmi";
+	phys = <&cp1_utmi0>, <&cp1_comphy2 0>;
+	phy-names = "usb", "usb3";
 	dr_mode = "host";
 	status = "okay";
 };
 
+&cp1_utmi0 {
+	status = "okay";
+};
+
 /* USB-2.0 Host to M.2 (J44) */
 &cp1_usb3_1 {
 	phys = <&cp1_utmi1>;
-	phy-names = "utmi";
+	phy-names = "usb";
 	dr_mode = "host";
 	status = "okay";
 };
 
-&cp1_utmi {
+&cp1_utmi1 {
 	status = "okay";
 };
-- 
2.35.3

